# DPI テスト計画

目的:
- マルチモニターかつ異なるスケール設定（DPI）環境で、キャプチャ領域の座標変換と出力画像サイズが期待通りであることを検証する。

概要:
- 手順: システムのディスプレイスケールを変更し、アプリ（`Shuyu.exe`）で領域選択を行うか自動スクリプトを実行して、出力画像のピクセル寸法が期待値と一致するか確認する。
- 自動化: リポジトリの `scripts/dpi_test.ps1` を利用してスクリーンキャプチャを取得し、画像サイズをログ出力する。

前提条件:
- Windows 10/11
- .NET 10 runtime（アプリ実行用）
- PowerShell (Windows PowerShell または PowerShell 7)

ファイル:
- `scripts/dpi_test.ps1`: 自動キャプチャスクリプト

実施手順（手順 A: 手動 / 手順 B: 自動）

手順 A — 手動確認
1. Windows の「ディスプレイ設定」から、各モニターのスケール (例: 100%, 125%, 150%) を設定する。
2. `Shuyu.exe` を起動する（`dotnet build` / `dotnet publish` でビルド済みのバイナリを使用）。
3. トレイからキャプチャを開始して、画面上の既知の矩形（例えば 200x100 DIP）を選択。
4. 出力された画像ファイル（保存先は設定に依存）を開き、ピクセルサイズが期待通り（DPI スケール × DIP）であることを確認する。

手順 B — 自動スクリプト（推奨、簡易）
1. PowerShell を管理者として起動し、リポジトリのルートに移動する。
2. 次のコマンドでスクリプトを実行（必要に応じて `-Rects` や `-OutDir` を調整）：

```powershell
.\scripts\dpi_test.ps1 -OutDir .\artifacts\dpi-tests
```

3. スクリプトは仮想スクリーン全体と、デフォルトで用意された複数の矩形をキャプチャして、画像のピクセル幅・高さをログに出力します。
4. 各スクリーンショットのサイズを確認し、期待するスケール係数でスケーリングされているか検証します。

期待する検証ポイント:
- 仮想スクリーンキャプチャのサイズがディスプレイ合成領域と一致する
- 指定した DIP サイズの矩形（例: 200x100 DIP）が、DPI に応じてピクセル値で正しくスケールされている
- 高 DPI 環境での座標のずれや粗さ（アーチファクト）がないこと

注意:
- スクリプトは OS の DPI 設定を変更しません。DPI を変更するには Windows の設定画面で行ってください。
- 一部のリモートデスクトップや仮想環境では DPI 情報が正しく取得できない場合があります。
